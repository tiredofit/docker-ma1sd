#!/command/with-contenv bash

DATA_PATH=${DATA_PATH:-"/data/"}
## Keep this at the top

CERT_PATH=${CERT_PATH:-"${DATA_PATH}/certs/"}
CONFIG_FILE=${CONFIG_FILE:-"ma1sd.yaml"}
CONFIG_PATH=${CONFIG_PATH:-"/config/"}
DB_ENABLE_POOL=${DB_ENABLE_POOL:-"FALSE"}
DB_FREE_CONNECTIONS_MAX=${DB_FREE_CONNECTIONS_MAX:-"5"}
DB_KEEP_ALIVE_INTERVAL_MS=${DB_KEEP_ALIVE_INTERVAL_MS:-"30000"}
DB_PORT=${DB_PORT:-"5432"}
DB_SQLITE_NAME=${DB_SQLITE_NAME:-"ma1sd.db"}
DB_SQLITE_PATH=${DB_SQLITE_PATH:-"${DATA_PATH}/sqlite/"}
DB_TEST_POOL=${DB_TEST_POOL:-"FALSE"}
DB_TIMEOUT=${DB_TIMEOUT:-"3600000"}
DB_TYPE=${DB_TYPE:-"POSTGRES"}
ENABLE_HASH=${ENABLE_HASH}:-"FALSE"}
ENABLE_INTERNAL_API=${ENABLE_INTERNAL_API:-"FALSE"}
ENABLE_LDAP=${ENABLE_LDAP:-"FALSE"}
ENABLE_MATRIX_API_V1=${ENABLE_MATRIX_API_V1:-"FALSE"}
ENABLE_MATRIX_API_V2=${ENABLE_MATRIX_API_V2:-"TRUE"}
HASH_DELAY=${HASH_DELAY:-"10s"}
HASH_LOOKUP_REQUESTS=${HASH_LOOKUP_REQUESTS:-"10"}
HASH_PEPPER_LENGTH=${HASH_PEPPER_LENGTH:-"20"}
INVITE_RESOLUTION_PERIOD=${INVITE_RESOLUTION_PERIOD:-"minutes"}
INVITE_RESOLUTION_TIMER=${INVITE_RESOLUTION_TIMER:-"5"}
INVITE_SHOW_FULL_DISPLAY_NAME=${INVITE_SHOW_FULL_DISPLAY_NAME:-"FALSE"}
LDAP_ATTRIBUTE_NAME=${LDAP_ATTRIBUTE_NAME:-"displayName"}
LDAP_ATTRIBUTE_UID=${LDAP_ATTRIBUTE_UID:-"uid"}
LDAP_ATTRIBUTE_UID_VALUE=${LDAP_ATTRIBUTE_UID_VALUE:-"uid"}
LDAP_BASE_DN=${LDAP_BASE_DN:-"dc=example,dc=com"}
LDAP_FILTER=${LDAP_FILTER:-"(objectClass=inetOrgPerson)"}
LDAP_LOOKUP=${LDAP_LOOKUP:-"TRUE"}
LDAP_PORT=${LDAP_PORT:-"389"}
LDAP_TLS=${LDAP_TLS:-"FALSE"}
LISTEN_PORT=${LISTEN_PORT:-"8090"}
LOG_FILE=${LOG_FILE:-"ma1sd.log"}
LOG_LEVEL=${LOG_LEVEL:-"INFO"}
LOG_LEVEL_APPS=${LOG_LEVEL_APPS:-"error"}
LOG_LEVEL_MA1SD=${LOG_LEVEL_MA1SD:-"info"}
LOG_PATH=${LOG_PATH:-"/logs/"}
LOG_TYPE=${LOG_TYPE:-"FILE"}
LOG_REQUESTS=${LOG_REQUESTS:-"FALSE"}
MATRIX_DOMAIN=${MATRIX_DOMAIN:-"matrix.org"}
SERVER_NAME=${SERVER_NAME:-"ma1sd.${MATRIX_DOMAIN}"}
SERVER_PUBLIC_URL=${SERVER_PUBLIC_URL:-"https://${SERVER_NAME}"}
SETUP_MODE=${SETUP_MODE:-"AUTO"}
SMTP_FROM=${SMTP_FROM:-"noreply@example.com"}
SMTP_TLS_MODE=${SMTP_TLS_MODE:-"ENABLE"}
case "${SMTP_TLS_MODE,,}" in
    enable | startls ) smtp_tls=1 ;;
    force ) smtp_tls=2 ;;
    full ) smtp_tls=3 ;;
    none | disable | off | false | *) smtp_tls=0 ;;
esac

case "${LDAP_MODE,,}" in
    ad | activedirectory | active_directory| microsoft | msldap ) ldap_ad_mode=true ;;
    openldap | *) ldap_ad_mode=false ;;
esac

